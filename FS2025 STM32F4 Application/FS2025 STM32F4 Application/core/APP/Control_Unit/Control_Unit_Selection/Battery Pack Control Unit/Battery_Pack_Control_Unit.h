	/**
  ******************************************************************************
  * @file           : Battery_Pack_Control_Unit.h
  * @brief          : Battery Pack Control Unit Functions header file
  ******************************************************************************
  * @attention
  *
  * (c) 2024 Uniovi E-tech Racing.
  * 
  *
  ******************************************************************************  
  ******************************************************************************
																Version Control
	******************************************************************************
	******************************************************************************		
  Version | dd mmm yyyy |       Who        | Description of changes
  ========|=============|==================|====================================
    1.0   | 01 MAR 2023 | Diego Rodríguez  | Creation
	========|=============|==================|====================================
	
  ******************************************************************************
  ******************************************************************************
  */
#ifndef BATTERY_PACK_CONTROL_UNIT_H
#define BATTERY_PACK_CONTROL_UNIT_H

/*******************************************************************************
********************************************************************************
***************										 Includes                      ***************	
********************************************************************************
*******************************************************************************/
#include "TypeDefs.h"
#include "State_LEDs.h"
#include "Can_Bus.h"
#include "LTC6811.h"
#include "MCU.h"
#include <math.h>
#include "LTC6811_Dual.h"

#define STM32F4_MCU

/*******************************************************************************
********************************************************************************
***************										Init Functions    		 		   	 ***************	
********************************************************************************
*******************************************************************************/
void Battery_Pack_Control_Unit_MCU_Init(void);
void Battery_Pack_Control_Unit_Init_Values(Control_Unit_TypeDef* Control_Unit);
void Battery_Pack_Control_Unit_Init(Control_Unit_TypeDef* Control_Unit);

/*******************************************************************************
********************************************************************************
***************										Generate Can messages   		 	 ***************	
********************************************************************************
*******************************************************************************/
void Generate_Status_Message(Control_Unit_TypeDef* Control_Unit);
void Generate_Temp_Message(Control_Unit_TypeDef* Control_Unit);
void LTC6811_Measure_Temperatures_and_Voltages(Control_Unit_TypeDef* Control_Unit);


/*******************************************************************************
********************************************************************************
***************										Tasks   		 									 ***************	
********************************************************************************
*******************************************************************************/
void Battery_Pack_Control_Unit_WDT_Task(void);
void Battery_Pack_Control_State_Machine_Task(Control_Unit_TypeDef* Control_Unit);
	

/*******************************************************************************
********************************************************************************
***************										Interrupt Tasks   		 				 ***************	
********************************************************************************
*******************************************************************************/
void CAN_Status_Send_Interrupt_Task(Control_Unit_TypeDef* Control_Unit);
void CAN_Temp_Send_Interrupt_Task(Control_Unit_TypeDef* Control_Unit);
void CAN_Temp_Timeout_Interrupt_Task(Control_Unit_TypeDef* Control_Unit);
void Initialitation_Tim_Interrupt_Task(Control_Unit_TypeDef* Control_Unit);
void Battery_Pack_Control_Interrupt_Task(Control_Unit_TypeDef* Control_Unit);
void Battery_Pack_Control_Unit_10ms_Interrupt(Control_Unit_TypeDef* Control_Unit);

/*******************************************************************************
********************************************************************************
***************										CAN Interrupt  	  		 				 ***************	
********************************************************************************
*******************************************************************************/
void Battery_Pack_Control_Unit_CAN1_Interrupt(Control_Unit_TypeDef* Control_Unit);


/*******************************************************************************
********************************************************************************
***************										Main task		      		 				 ***************	
********************************************************************************
*******************************************************************************/
void Battery_Pack_Control_Unit_Main_Task(Control_Unit_TypeDef* Control_Unit);


/*******************************************************************************
********************************************************************************
***************										Memory MAP	      		 				 ***************	
********************************************************************************
*******************************************************************************/
typedef enum
{
	Address_Unique_ID_B0 								= 0x1FFF7800,
	Address_Unique_ID_B1,
	Address_Unique_ID_B2,
	Address_Unique_ID_B3,
	Address_Bootloader_Stay_Condition 	= (0x08004000U),
	Address_Device,
	Address_Bootloader_Version,
	
	Address_APP0_Version 								= (0x08004000U + 8),
	Address_APP0_Address 								= (0x08004000U + 12),
	Address_APP0_CRC 										= (0x08004000U + 16),
	Address_APP0_Code_Length						= (0x08004000U + 20),
	
	Address_APP_BPCU_Activated_Sensors  = (0x08008000U) 
	
} Device_Addresses_Enum;

#endif
	/*****************************************************************************
	** 																END OF FILE																**			
	******************************************************************************
	******************************************************************************
  * @file           : Rear_Control_Unit.h
  * @brief          : Rear Control Unit Functions header file
  ******************************************************************************
  * @attention
  *
  * (c) 2024 Uniovi E-tech Racing.
  * 
  *
  ******************************************************************************  
  ******************************************************************************
																Version Control
	******************************************************************************
	******************************************************************************		
  Version | dd mmm yyyy |       Who        | Description of changes
  ========|=============|==================|====================================
    1.0   | 01 MAR 2023 | Diego Rodríguez  | Creation
	========|=============|==================|====================================
	
  ******************************************************************************
  ******************************************************************************
  */



