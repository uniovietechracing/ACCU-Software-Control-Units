	/**
  ******************************************************************************
  * @file           : LTC6811.h
  * @brief          : LTC6811 header file
  ******************************************************************************
  * @attention
  *
  * (c) 2024 Uniovi E-tech Racing.
  * 
  *
  ******************************************************************************  
  ******************************************************************************
																Version Control
	******************************************************************************
	******************************************************************************		
  Version | dd mmm yyyy |       Who        | Description of changes
  ========|=============|==================|====================================
    1.0   | 01 MAR 2023 | Diego Rodríguez  | Creation
	========|=============|==================|====================================
	
  ******************************************************************************
  ******************************************************************************
  */
#ifndef LTC6811_H
#define LTC6811_H

/*******************************************************************************
********************************************************************************
***************										 Includes                      ***************	
********************************************************************************
*******************************************************************************/
#include "MCU.h"
#include "Typedefs.h"
#include <stdint.h>
#include <string.h>

#define SPI_MAX_DELAY 200



/*******************************************************************************
********************************************************************************
***************						 			 	Inicializacion				  		   ***************
********************************************************************************
*******************************************************************************/
void LTC6811_Init(Control_Unit_TypeDef* Control_Unit);
void LTC6811_SPI_Init(void);


/*******************************************************************************
********************************************************************************
***************						  		 	 	spi					    		    		 ***************
********************************************************************************
*******************************************************************************/
void LTC6811_SPI_Transfer(LTC6811_Typdef* LTC6811, uint8_t *tx, uint16_t len);
void LTC6811_SPI_Transfer_No_CS(LTC6811_Typdef* LTC6811, uint8_t *tx, uint16_t len);
void LTC6811_SPI_Transmit_Receive(LTC6811_Typdef* LTC6811, uint8_t *tx, uint8_t *rx, uint16_t len_tx, uint16_t len_rx);


/*******************************************************************************
********************************************************************************
***************						  	Configuracion y Wake UP				  	 ***************
********************************************************************************
*******************************************************************************/
void LTC6811_Wake_Up(LTC6811_Typdef* LTC6811);
void LTC6811_Write_CFG(LTC6811_Typdef* LTC6811);
BoolTypeDef LTC6811_Read_CFG(LTC6811_Typdef* LTC6811, uint8_t* config_out);



/*******************************************************************************
********************************************************************************
***************						  READ VOLTAGES					  		    		 ***************
********************************************************************************
*******************************************************************************/
void LTC6811_Start_ADC_Conv(LTC6811_Typdef* LTC6811);
BoolTypeDef LTC6811_Wait_ADC_Completion(LTC6811_Typdef* LTC6811, uint16_t timeout_ms);
void LTC_Read_All_Voltages(LTC6811_Typdef *LTC6811, float *voltages);
BoolTypeDef LTC6811_Read_Cell_Block(LTC6811_Typdef* LTC6811, uint8_t cmd1, uint8_t cmd2, uint16_t *cell_voltages);


/*******************************************************************************
********************************************************************************
***************						  			 	Balanceo				  		    		 ***************
********************************************************************************
*******************************************************************************/
void LTC_Disable_Balancing(LTC6811_Typdef* LTC6811);
void LTC_Active_Odd_Balancing(LTC6811_Typdef* LTC6811);
void LTC_Active_Even_Balancing(LTC6811_Typdef* LTC6811);


/*******************************************************************************
********************************************************************************
***************						  			 	Conversion					  		   ***************
********************************************************************************
*******************************************************************************/
float LTC_Voltage_to_Temperature(float v);
uint8_t LTC6811_Encode_Temp(float Temp);
uint8_t LTC6811_Encode_Volt_10mV(float volt);

/*******************************************************************************
********************************************************************************
***************						  	Tarea de Medida					  		    	***************
********************************************************************************
*******************************************************************************/
void LTC6811_Measure_Temperatures_and_Voltages(Control_Unit_TypeDef* Control_Unit);


/*******************************************************************************
********************************************************************************
***************						  			 	pec 15					  		    	***************
********************************************************************************
*******************************************************************************/
uint16_t LTC6811_PEC15_Calc(uint8_t *data, uint8_t len);

#endif	
/**
  ******************************************************************************
  * @file           : State_LEDs.h
  * @brief          : State_LEDs header file
  ******************************************************************************
  * @attention
  *
  * (c) 2024 Uniovi E-tech Racing.
  * 
  *
  ******************************************************************************  
  ******************************************************************************
																Version Control
	******************************************************************************
	******************************************************************************		
  Version | dd mmm yyyy |       Who        | Description of changes
  ========|=============|==================|====================================
    1.0   | 01 MAR 2023 | Diego Rodríguez  | Creation
	========|=============|==================|====================================
	
  ******************************************************************************
  ******************************************************************************
  */